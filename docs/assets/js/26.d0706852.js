(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{294:function(v,t,e){"use strict";e.r(t);var n=e(1),a=Object(n.a)({},(function(){var v=this,t=v.$createElement,e=v._self._c||t;return e("ContentSlotsDistributor",{attrs:{"slot-key":v.$parent.slotKey}},[e("p",[v._v("こんにちは．最近は呪術廻戦をアニメで見て漫画を全巻揃えてしまいました．いつになってもバトル漫画は良いものです．今回はNTTコミュニケーションズさんにより開催されたインターンシップに参加して二週間ネットワークをゴニョゴニョしてきました．")]),v._v(" "),e("h2",{attrs:{id:"参加まで"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参加まで"}},[v._v("#")]),v._v(" 参加まで")]),v._v(" "),e("h3",{attrs:{id:"応募"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#応募"}},[v._v("#")]),v._v(" 応募")]),v._v(" "),e("p",[v._v("本インターンシップの存在は友人に教えられて知りました．インターンシップの内容が非常に興味深いものばかりだったためどのポストに応募するか非常に悩みましたが"),e("strong",[v._v("次世代キャリアネットワーク(Autonomous Network)開発エンジニア")]),v._v("というポストに応募することにしました．業務内容はSegment Routingを用いたネットワーク構築や制御の検証/開発というものでした．")]),v._v(" "),e("h3",{attrs:{id:"選考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#選考"}},[v._v("#")]),v._v(" 選考")]),v._v(" "),e("p",[v._v("選考はエントリーシートを提出してから何回かの面接・面談を経て合格の連絡をいただきました．\nSegment Routingなどルーティングプロトコルに関して完全に素人なのに選んでいただきありがたかったです．")]),v._v(" "),e("h3",{attrs:{id:"本番まで"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#本番まで"}},[v._v("#")]),v._v(" 本番まで")]),v._v(" "),e("p",[v._v("インターンシップ本番までにインターンシップで使用するMacと大量のお菓子と飲み物が届きました．残念ながら写真を撮り忘れてしまいましたが非常に美味しくいただきました．")]),v._v(" "),e("h2",{attrs:{id:"取り組んだこと"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#取り組んだこと"}},[v._v("#")]),v._v(" 取り組んだこと")]),v._v(" "),e("p",[v._v("上述しましたが僕が今回参加させていただいたポストは次世代キャリアネットワーク(Autonomous Network)開発エンジニアです．\n業務内容は次世代商用インフラを想定した検証ネットワークの構築というものでした．SRv6という新しい経路制御技術を用いてネットワークを構築・経路制御を検証しました．")]),v._v(" "),e("h3",{attrs:{id:"背景"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[v._v("#")]),v._v(" 背景")]),v._v(" "),e("p",[v._v("本検証の背景としてコストの課題があります．NTTコミュニケーションズのように，サービスや目的ごとに個別のネットワークを所有することは運用コストや設備コストがかかります．本検証では，複数のネットワークを統一して構築・運用することでコストを削減することを目指します．そこで有用だと考えられる技術がSRv6です．SRv6は既存のIPv6網を使用して構築することができ，シンプルなネットワーク構成を保つことができます．また，Function機能などを有しており拡張性などにも優れています．そのため，今回のインターンシップではSRv6を用いたネットワークの検証を行いました．")]),v._v(" "),e("h3",{attrs:{id:"srv6"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#srv6"}},[v._v("#")]),v._v(" SRv6")]),v._v(" "),e("p",[v._v("軽くSRv6という技術について触れます．SRv6に関して僕は有識者ではないためここは資料を参考に概要程度に留めます．詳細は参考資料を参照ください．")]),v._v(" "),e("h4",{attrs:{id:"概要"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#概要"}},[v._v("#")]),v._v(" 概要")]),v._v(" "),e("p",[v._v("SRv6とはSegment Routing IPv6の略です．名前の通りセグメントルーティングを実現する技術で，そのデータプレーンにIPv6を使用します．\nセグメントルーティングではルーティングポリシーに合わせた経路や各ノードの行う処理の情報をパケットに格納して転送することでより柔軟な経路制御を実現することができます．\nセグメントルーティングを実現する手法としてMPLSを利用するSR-MPLSとIPv6を利用するSRv6があります．今回SR-MPLSについては触れません(詳しくないので)．\nSRv6ではIPv6の拡張ヘッダを用いてSRH(SR Header)を付与します．SRHに経路ポリシーを定義することでSRv6を解釈できるネットワーク内で柔軟に経路制御を行うことができます．\nまた，SRv6においてパケットの処理方法を識別する識別子(SID)はIPv6アドレスを使用します．")]),v._v(" "),e("p",[v._v("SRv6 SIDには")]),v._v(" "),e("ul",[e("li",[e("em",[v._v("Locator")]),v._v(": セグメントをペアレントノードへRouteするためのビット")]),v._v(" "),e("li",[e("em",[v._v("Function")]),v._v(": ペアレントノードにおいて取られるActionを示すビット")]),v._v(" "),e("li",[e("em",[v._v("Argument(Optional)")]),v._v(": 最後のビットはFunctionで参照される引数")])]),v._v(" "),e("p",[v._v("の三つのフィールドがあります．\nここで僕が驚いたことはIPv6アドレス自体にFunctionなどの役割を持たせていることです．アドレスにアドレス以外の役割を持たせることに慣れるのに時間がかかりました．\nFunctionフィールドにパケットが到着したノードが行うべき処理を定義することで様々な機能を実現しています．")]),v._v(" "),e("h4",{attrs:{id:"特徴"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#特徴"}},[v._v("#")]),v._v(" 特徴")]),v._v(" "),e("p",[v._v("SRv6の特徴をいくつか紹介します．")]),v._v(" "),e("ul",[e("li",[v._v("データプレーンにIPv6を使用\n"),e("ul",[e("li",[v._v("SRv6に対応していないIPv6ネットワークをそのまま土管として使用することができる")]),v._v(" "),e("li",[v._v("IPv6アドレスをSIDとして使用")])])]),v._v(" "),e("li",[v._v("SRHの付与方法にはEncapulationモードとInsert(Inline)モードがある\n"),e("ul",[e("li",[v._v("EncapモードはIPv4などに対応可能")]),v._v(" "),e("li",[v._v("Insertモードはヘッダのオーバーヘッド削減")])])]),v._v(" "),e("li",[v._v("SRv6 functionによる高い拡張性\n"),e("ul",[e("li",[v._v("Well known functionがいくつか定義されている")]),v._v(" "),e("li",[v._v("任意の機能を追加可能")])])])]),v._v(" "),e("h4",{attrs:{id:"srv6のユースケース"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#srv6のユースケース"}},[v._v("#")]),v._v(" SRv6のユースケース")]),v._v(" "),e("h4",{attrs:{id:"vpn"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#vpn"}},[v._v("#")]),v._v(" VPN")]),v._v(" "),e("p",[v._v("SRv6を使用することでIPv6ネットワークをアンダーレイネットワークとしてオーバーレイネットワークを構築することができます．オーバーレイネットワークを構築することでネットワークを柔軟に分割することが可能になります．")]),v._v(" "),e("h5",{attrs:{id:"traffic-engineering"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#traffic-engineering"}},[v._v("#")]),v._v(" Traffic Engineering")]),v._v(" "),e("p",[v._v("Traffic Engineeringはポリシーに従い経路を柔軟に制御する技術のことを指します．SRv6を用いてトラフィックエンジニアリングを実現することで目的に合わせたネットワークの運用が可能になります．")]),v._v(" "),e("h5",{attrs:{id:"service-function-chaining"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#service-function-chaining"}},[v._v("#")]),v._v(" Service Function Chaining")]),v._v(" "),e("p",[v._v("Service Function Chainingはネットワーク上の機器を特定の順番で繋ぎ，サービスとして提供する技術です．特定のソースからのパケットに対して飲みファイアウォールを通したいというような状況で有効です．")]),v._v(" "),e("h4",{attrs:{id:"参考資料"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考資料"}},[v._v("#")]),v._v(" 参考資料")]),v._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://www.intellilink.co.jp/article/column/5G-SR01.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("セグメントルーティングとは？ | NTTデータ先端技術株式会社"),e("OutboundLink")],1)]),v._v(" "),e("li",[e("a",{attrs:{href:"https://www.ntt.com/about-us/press-releases/news/article/2019/0614.html",target:"_blank",rel:"noopener noreferrer"}},[v._v("高速ソフトウェアPCルーター「Kamuee」を用いたSRv6の実証実験に成功"),e("OutboundLink")],1)]),v._v(" "),e("li",[e("a",{attrs:{href:"https://www.janog.gr.jp/meeting/janog40/application/files/2415/0051/7614/janog40-sr-kamata-takeda-00.pdf",target:"_blank",rel:"noopener noreferrer"}},[v._v("JANOG40_SR_Tutorial"),e("OutboundLink")],1)])]),v._v(" "),e("h3",{attrs:{id:"検証"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#検証"}},[v._v("#")]),v._v(" 検証")]),v._v(" "),e("p",[v._v("今回検証したのは以下についてです．")]),v._v(" "),e("ul",[e("li",[v._v("[VPN] End.DT6というSRv6 Functionを使用したIPv6 over IPv6のL3VPNの実現")]),v._v(" "),e("li",[v._v("[VPN] End.DX4を使用したIPv4 over IPv6のL3VPNの実現")]),v._v(" "),e("li",[v._v("[TE]  SRv6を用いた柔軟な経路制御")]),v._v(" "),e("li",[v._v("[SFC] End.ATを使用したService Function ChainingとそのXDP実装の検証")])]),v._v(" "),e("p",[v._v("検証環境として"),e("code",[v._v("Ubuntu20.04.2 LTS / Linux Kernel 5.4.0-65-generic, iproute2-ss200127")]),v._v("を使用しました．\n検証内容についてそれぞれを軽く紹介します．")]),v._v(" "),e("h4",{attrs:{id:"end-dt6というsrv6-functionを使用したipv6-over-ipv6のl3vpnの実現"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#end-dt6というsrv6-functionを使用したipv6-over-ipv6のl3vpnの実現"}},[v._v("#")]),v._v(" End.DT6というSRv6 Functionを使用したIPv6 over IPv6のL3VPNの実現")]),v._v(" "),e("p",[v._v("今回の検証では図のようなネットワークを検証に用いました．\n"),e("img",{attrs:{src:"/img/ntt-fig1.png",alt:"ntt-fig1"}}),v._v("\n検証ネットワークではTenant-AとTenant-Bという二つのテナントが用意されていて，二つのテナントは同一のSR domain(SRv6が有効なネットワーク)に接続されています．Tenant-A, BはそれぞれRouter-1, 4でVRF A, Bにより分離されています．\n今回は"),e("code",[v._v("End.DT6")]),v._v("というFunctionを用いて属するVRFに応じて任意に異なる経路を選択できるように設定し疎通を検証しました．\nSRv6の設定追加に関してはLinuxの"),e("code",[v._v("iproute2")]),v._v("を使用します．詳細は割愛しますがいくつかのSRv6 Functionに対応しています．\n"),e("code",[v._v("End.DT6")]),v._v("を使用したper-VRF IPv6 over IPv6 L3VPNのフローは以下です．")]),v._v(" "),e("ul",[e("li",[v._v("SE domainの入り口に到着したIPv6パケットに対して宛先を判断して"),e("code",[v._v("H.Encap")]),v._v("(もしくは"),e("code",[v._v("H.Insert")]),v._v(")によりSRHを付加します．")]),v._v(" "),e("li",[v._v("各ノードはSRHを参照し次のノードを判断して転送を行います．("),e("code",[v._v("End")]),v._v(")")]),v._v(" "),e("li",[e("code",[v._v("End.DT6")]),v._v("は付加されたSRHをDecapし，対応するVRFの経路表を参照して転送を行います．")])]),v._v(" "),e("h5",{attrs:{id:"結果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#結果"}},[v._v("#")]),v._v(" 結果")]),v._v(" "),e("p",[e("code",[v._v("End.DT6")]),v._v("を使用したL3VPNは問題なく実現することができました．\n例として\nhostA-1, hostB-1に"),e("code",[v._v("fd00:100::2")]),v._v(", hostA-2, hostB-2に"),e("code",[v._v("fd00:200::2")]),v._v("のように同一のアドレスを割り当てて，")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("hostA-1(hostB-1)<fd00:100::2> -> hostA-2(hostB-2)<fd00:200::2>\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("に対してpingを飛ばすと意図したホストにそれぞれ届くことが確認できました．\n検証では"),e("code",[v._v("ping")]),v._v("と"),e("code",[v._v("tcpdump")]),v._v("を使用して確認しました．")]),v._v(" "),e("p",[v._v("一方で，今回検証したper-VRF IPv6 over IPv6 L3VPNではSRHの付加方式にには"),e("code",[v._v("H.Encap")]),v._v("(Encapモード)と"),e("code",[v._v("H.Insert")]),v._v("(Insertモード)があります．今回使用した"),e("code",[v._v("iproute2")]),v._v("ではEncapモードは正常に動作しますが，Insertモードは実装が完全ではなくInsert自体は行われますが，出口で正常にDecapが行われないということが判明しました．")]),v._v(" "),e("h4",{attrs:{id:"end-dx4を使用したipv4-over-ipv6のl3vpnの実現"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#end-dx4を使用したipv4-over-ipv6のl3vpnの実現"}},[v._v("#")]),v._v(" End.DX4を使用したIPv4 over IPv6のL3VPNの実現")]),v._v(" "),e("p",[v._v("検証ネットワークとして図のようなネットワークのTenant-Cを使用しました．\n"),e("img",{attrs:{src:"/img/ntt-fig2.png",alt:"ntt-fig2"}}),v._v(" "),e("code",[v._v("End.DX4")]),v._v("を使用したper-CE Ipv4 over IPv6 L3VPNのフローは以下です．")]),v._v(" "),e("ul",[e("li",[v._v("SE domainの入り口に到着したIPv6パケットに対して宛先を判断して"),e("code",[v._v("H.Encap")]),v._v("を行う．")]),v._v(" "),e("li",[v._v("各ノードはSRHを参照し次のノードを判断して転送を行います．("),e("code",[v._v("End")]),v._v(")")]),v._v(" "),e("li",[e("code",[v._v("End.DX4")]),v._v("は付加されたSRHをDecapし，予め設定されたNext Hopに対して転送を行います．")])]),v._v(" "),e("h5",{attrs:{id:"結果-2"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#結果-2"}},[v._v("#")]),v._v(" 結果")]),v._v(" "),e("p",[v._v("こちらも同様に問題なく動作しました．")]),v._v(" "),e("h4",{attrs:{id:"srv6を用いた柔軟な経路制御"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#srv6を用いた柔軟な経路制御"}},[v._v("#")]),v._v(" SRv6を用いた柔軟な経路制御")]),v._v(" "),e("p",[v._v("こちらでは上で作成したEnd.DT6, End.DX4の設定を施したネットワークに対して様々な経路を定義して定義通りに転送されるかを検証しました．")]),v._v(" "),e("h5",{attrs:{id:"ループを作ってみる"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#ループを作ってみる"}},[v._v("#")]),v._v(" ループを作ってみる")]),v._v(" "),e("p",[v._v("経路定義にてループを定義してみました．通常のネットワークではループを定義することはできないのでこのような定義ができるのはSRならではと言えます．\n具体的には")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("hostA-1 -> router-1 -> router-2 -> router-3 -> router-1 -> router-2 -> router-4 -> hostA-2\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("のような経路を定義して疎通が確認できました．")]),v._v(" "),e("h5",{attrs:{id:"srv6非対応なipv6ノードにsrv6パケットを転送させる"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#srv6非対応なipv6ノードにsrv6パケットを転送させる"}},[v._v("#")]),v._v(" SRv6非対応なIPv6ノードにSRv6パケットを転送させる")]),v._v(" "),e("p",[v._v("SRv6の特徴にIPv6ネットワークをバックボーンのネットワークとして使用できることがあります．\nSRv6はIPv6ヘッダの宛先アドレスを書き換えながら転送を行うため，SR domain内にSRv6非対応なノードが存在していたとしても，そのノードには単なるIPv6パケットとして認識されるため正常に転送を行うことが可能です．\n具体的にrouter-2に対してSRv6を無効化して")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("hostA-1 -> router-1 -> router-4 -> hostA-2\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("のようなSRv6の経路を設定してもrouter-1, router-4間のバックボーンネットワークで最短経路としてrouter-2を経由するように定義されているためパケットは")]),v._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[v._v("hostA-1 -> router-1 -> (router-2) -> router-4 -> hostA-2\n")])]),v._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[v._v("1")]),e("br")])]),e("p",[v._v("という風に転送されました．")]),v._v(" "),e("h4",{attrs:{id:"end-atを使用したservice-function-chainingとそのxdp実装の検証"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#end-atを使用したservice-function-chainingとそのxdp実装の検証"}},[v._v("#")]),v._v(" End.ATを使用したService Function ChainingとそのXDP実装の検証")]),v._v(" "),e("p",[v._v("2019 ShowNetのNOCにより，IPv4パケットに対しService Function Chainingを実現するためのFunctionとして"),e("code",[v._v("End.AT")]),v._v("が提案されています．\nこちらは"),e("code",[v._v("iproute2")]),v._v("には実装されていないため，NTTコミュニケーションズのedenさんが作成されたXDPを用いた実装を使用して検証しました．\nリポジトリはこちら "),e("a",{attrs:{href:"https://github.com/edenden/end.ac",target:"_blank",rel:"noopener noreferrer"}},[v._v("edenden/end.ac"),e("OutboundLink")],1),v._v("\n検証ネットワークはEnd.DX4で使用したネットワークを使用しました．\nrouter-5で"),e("code",[v._v("End.AT")]),v._v("のプログラムを動作させて検証します．\n"),e("code",[v._v("End.AT")]),v._v("はService Function Chainingを実現するためにSR domain外で動作するFunction(サービス)にパケットを転送する機能を提供します．そのために"),e("code",[v._v("End.AT")]),v._v("では一度SRHをDecapしてFunctionにパケットを渡します．この時，Functionから帰ってくるパケットに対してもう一度SRHを適切に付加する必要があるためSRHをキャッシュしておきDecapしたIPv4パケットのTOSフィールドに識別値を埋め込んで送出します．帰ってきたパケットのTOSフィールドを確認して対応するSRHをもう一度付加することで正常な転送を実現しています．")]),v._v(" "),e("h5",{attrs:{id:"結果-3"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#結果-3"}},[v._v("#")]),v._v(" 結果")]),v._v(" "),e("p",[v._v("XDPを使用するプログラムを動作させることは特別な設定が必要だったり特定用途に限定して実装してるため動作させることに少し苦労しましたが社員の方々にサポートしていただきながらなんとか検証することができました．\n実際にService Function Chainingが動作していることを確認できてよかったです．\nまた，XDPのプログラムを自分で変更して動作させることに挑戦しました．IPv4のTosフィールドに書き込まれる値を変更して動作させることには成功したものの挙動そのものを変更させることはタイムアップとなってしまいました．残念です．")]),v._v(" "),e("h2",{attrs:{id:"まとめ"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#まとめ"}},[v._v("#")]),v._v(" まとめ")]),v._v(" "),e("p",[v._v("今回はSRv6という新しい技術で自分自身前提となる知識もほとんどない技術に挑戦させていただく機会をいただきました．\n新しい技術を学ぶことはいつでも楽しいものです．\n今回のインターンシップを通してネットワークやパケット処理に対して興味が深まりました．\n貴重な機会をいただいたNTTコミュニケーションズ様に感謝します．\nまた，メンターの方をはじめとした社員の方々には全日程リモート開催にもかかわらず懇親会やLT会など期間中様々な企画を開催していただきありがとうございました．\n最後に本ブログを執筆するために資料の使用を快く許諾していただきましてありがとうございます．非常に楽しいインターンシップでした．")])])}),[],!1,null,null,null);t.default=a.exports}}]);